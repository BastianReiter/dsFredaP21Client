<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bastian Reiter">

<title>CCPhos Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="CCPhosTutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="CCPhosTutorial_files/libs/quarto-html/quarto.js"></script>
<script src="CCPhosTutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="CCPhosTutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="CCPhosTutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="CCPhosTutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="CCPhosTutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="CCPhosTutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="CCPhosTutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="CCPhosTutorial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CCPhos Tutorial</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bastian Reiter </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The German Cancer Consortium’s (DKTK) Clinical Communication Platform (CCP) is built on a federated infrastructure. Each participating site - usually a university hospital - holds data on a server called <em>bridgehead</em>. To foster clinical research with these data and enable analysis while protecting patient data privacy, the CCP developed solutions for federated data analysis. This means that researchers will not have direct access to individual-level patient data. Rather they will send commands to an R session running on the participating servers from their own bridgehead (<em>client</em>) and receive aggregated statistics which will then be further processed to get cumulated analysis results. The open source software <strong>DataSHIELD</strong> provides functionality for secure communication between client and server. It is important to note that this does not entail any transfer of individual-level data from the servers. While federated data analysis is a powerful solution to enable research with real world health data, it poses a variety of challenges, including:</p>
<ul>
<li>Processing data without ability do control output on individual-level</li>
<li>Potential selection biases induced by data heterogeneity</li>
<li>Some methods deliver mathematically equivalent results in a federated setting, others can only be considered ‘virtual meta analyses’</li>
</ul>
</section>
<section id="ccphos" class="level2">
<h2 class="anchored" data-anchor-id="ccphos">CCPhos</h2>
<p>CCPhos enables you to process, explore and analyze data in the federated infrastructure of the DKTK-CCP. It consists of three <em>R</em> packages:</p>
<ul>
<li><code>dsCCPhos</code> (runs in server R session)
<ul>
<li>Contains functionality that processes individual-level data and returns aggregated statistics</li>
</ul></li>
<li><code>dsCCPhosClient</code> (runs in client R session)
<ul>
<li>Functions send commands to servers and process the returned responses</li>
</ul></li>
<li><code>CCPhosApp</code> (runs in client R session)
<ul>
<li>A Shiny app to facilitate general usage, process monitoring as well as data exploration)</li>
</ul></li>
</ul>
</section>
<section id="datashield" class="level2">
<h2 class="anchored" data-anchor-id="datashield">DataSHIELD</h2>
<p>To use CCPhos and analyze CCP data you will not need to have a deep understanding of how <em>DataSHIELD</em> works. However, for more complex tasks it can be useful to familiarize yourself with its functionality, especially if you aim to use enhancing packages. The <em>DataSHIELD</em> core group developed <code>dsBase/dsBaseClient</code> which lets you use some general functions you may know from the <code>base</code> package in <em>R</em>. The <em>DataSHIELD</em> community is an active and open platform. Contributors developed a broad variety of enhancing packages, for example <code>dsTidyverse</code> that lets you use functions known from the “normal” <code>tidyverse</code> package family. Generally speaking, <em>DataSHIELD</em> packages always consist of a package pair - one part runs on the server-side, one on the client-side. Functions from these packages are usually directly paired. A server-side function may be named <code>somefunctionDS()</code> and can be called within a client-side function named <code>ds.somefunction()</code>. There are two main types of server-side <em>DataSHIELD</em> functions:</p>
<ul>
<li>ASSIGN
<ul>
<li>Functions of this type do not return any data to the client, they serve as a way to create new objects on the server</li>
</ul></li>
<li>AGGREGATE
<ul>
<li>These functions return some kind of aggregated data (like an arithmetic mean, a quantile or a frequency table) to the client</li>
</ul></li>
</ul>
<p>To learn more about <em>DataSHIELD</em>, please head to the <em>DataSHIELD</em> Community Wiki: <a href="https://wiki.datashield.org" class="uri">https://wiki.datashield.org</a>. They also a useful tutorials.</p>
</section>
<section id="tutorial" class="level2">
<h2 class="anchored" data-anchor-id="tutorial">Tutorial</h2>
<p>This tutorial is centered around the functionality of <code>dsCCPhosClient</code>. To demonstrate the general workflow and enable testing as well as script development without connecting to the real world bridgeheads, <code>dsCCPhosClient</code> entails the possibility to connect to virtual servers (making use of the package <code>DSLite</code>). For the purposes of this tutorial we will use this virtual setting but also show how to potentially connect to real world servers. After the connection process, the general workflow and thus the steps in this tutorial are the same for both ways.</p>
<section id="setup" class="level4">
<h4 class="anchored" data-anchor-id="setup">Setup</h4>
<p>First, we need to install and load some necessary packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)   <span class="co"># This is needed to install packages from remote repositories</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The client-side part of dsCCPhos:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">"BastianReiter/dsCCPhosClient"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># When using this tutorial with the virtual setup, we will also need the server-side part of CCPhos and dsBase:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">"BastianReiter/dsCCPhos"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">"datashield/dsBase"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's also install other DataSHIELD packages to get more functionality:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dsTidyverse"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dsTidyverseClient"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load some package namespaces</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsBaseClient)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsCCPhosClient)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsTidyverseClient)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="connect" class="level4">
<h4 class="anchored" data-anchor-id="connect">Connect</h4>
<p>As mentioned above for the purposes of this tutorial you can either connect to virtual servers or to real world servers if you have access.</p>
<section id="virtual-infrastructure" class="level6">
<h6 class="anchored" data-anchor-id="virtual-infrastructure">Virtual Infrastructure</h6>
<p>We need some artificial test data to setup the virtual infrastructure. You can obtain a suitable .rds-file upon request.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in test data inserting your respective file path</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>TestData <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"CCPTestData.rds"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can use the following convenience function to connect to virtual servers</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>CCPConnections <span class="ot">&lt;-</span> <span class="fu">ConnectToVirtualCCP</span>(<span class="at">CCPTestData =</span> TestData,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">NumberOfSites =</span> <span class="dv">3</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">NumberOfPatientsPerSite =</span> <span class="dv">2000</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">AddedDsPackages =</span> <span class="st">"dsTidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="real-world-servers" class="level6">
<h6 class="anchored" data-anchor-id="real-world-servers">Real world servers</h6>
<p>If you instead want to connect to real world servers, you need credentials for each server. In specific, these are pairs of a server <em>URL</em> and a <em>secret token</em>, the latter being a large string of characters and numbers. You can use the convenience function <code>ConnectToCCP()</code> that returns a list of so-called <code>DSConnection</code> objects. You will use this list (saved here under the name <code>CCPConnections</code>) every time you call a <em>DataSHIELD</em>-function throughout this course. For <code>ConnectToCCP()</code> to work you need to pass the server credentials in the form of a <code>data.frame</code> with a specific structure:</p>
<table class="table">
<thead>
<tr class="header">
<th>SiteName</th>
<th>URL</th>
<th>ProjectName</th>
<th>Token</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sissy</td>
<td>https://sissyserver/opal</td>
<td>TestProject</td>
<td>xxx123456789</td>
</tr>
<tr class="even">
<td>Franz</td>
<td>https://franzserver/opal</td>
<td>TestProject</td>
<td>xxx234567891</td>
</tr>
</tbody>
</table>
<p>You can either create this <code>data.frame</code> manually in the R session or also save the credentials in a csv-file that you upload to your R session. Note: The specification of <em>ProjectName</em> is needed because it may differ from server to server due to technical reasons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in CCP site specifications from uploaded file...</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Credentials <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"SiteSpecs.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ... or enter specifications manually</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>Credentials <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SiteName =</span> <span class="fu">c</span>(<span class="st">"Sissy"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"Franz"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">URL =</span> <span class="fu">c</span>(<span class="st">"https://sissyserver/opal"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"https://franzserver/opal"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ProjectName =</span> <span class="fu">c</span>(<span class="st">"TestProject"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"TestProject"</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Token =</span> <span class="fu">c</span>(<span class="st">"xxx123456789"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"xxx234567891"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="check-server-requirements" class="level4">
<h4 class="anchored" data-anchor-id="check-server-requirements">Check server requirements</h4>
<p>After successful connection let us make sure that all participating servers fulfil certain requirements so that we don’t run into trouble down the way. We can define and check these requirements using another convenience function <code>CheckServerRequirements()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># When connecting to real world servers we need the 'Credentials' data.frame again to pass the before-mentioned project names.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In the virtual setting we can just set the argument NULL.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ServerRequirements <span class="ot">&lt;-</span> <span class="fu">CheckServerRequirements</span>(<span class="at">CCPSiteSpecifications =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">DataSources =</span> CCPConnections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-raw-data-set" class="level4">
<h4 class="anchored" data-anchor-id="load-raw-data-set">Load Raw Data Set</h4>
<p>We are now connected to the servers, this means we have access to both the <em>Opal</em> database where the raw data is stored as well as an <em>R</em> session that runs on the server. In order to actually work with the data we have to load the database tables into the <em>R</em> session, where they will be accessible as <em>R</em> objects. Specifically, using the following functionality, we will assign the <em>Raw Data Set (RDS)</em> tables as <code>data.frame</code> objects. To facilitate working with this data set we will bundle them in a <code>list</code> object, which we will call <code>RawDataSet</code>. All of this is done by <code>LoadRawDataSet()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, when dealing with real world servers, we have to pass the 'Credentials' object defined at login.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Messages <span class="ot">&lt;-</span> <span class="fu">LoadRawDataSet</span>(<span class="at">CCPSiteSpecifications =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">DataSources =</span> CCPConnections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-rds-tables" class="level4">
<h4 class="anchored" data-anchor-id="check-rds-tables">Check RDS tables</h4>
<p>Before we move on, let’s take a look at these <em>RDS</em> tables using <code>ds.CheckDataSet</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>RDSTableCheck <span class="ot">&lt;-</span> <span class="fu">ds.CheckDataSet</span>(<span class="at">DataSources =</span> CCPConnections,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">DataSetName =</span> <span class="st">"RawDataSet"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">AssumeCCPDataSet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting object <code>RDSTableCheck</code> contains useful meta data, in particular about the completeness of the <em>RDS</em> tables. In a real analysis it is recommended to take a close look at it to gain insight into the initial quality of these real world data. This is where the <em>CCPhosApp</em> is very helpful, since it automatically displays the resulting meta data in an easily accessible way. For now, let’s have a look at the content of <code>RDSTableCheck</code> by exploring it via the console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabular overview of the RDS tables' feature-wise completeness</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(RDSTableCheck<span class="sc">$</span>TableStatus)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can dive deeper by accessing the other list objects and look at a specific RDS table (here 'RDS_Diagnosis')</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(RDSTableCheck<span class="sc">$</span>TableRowCounts<span class="sc">$</span>RDS_Diagnosis)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(RDSTableCheck<span class="sc">$</span>FeatureExistence<span class="sc">$</span>RDS_Diagnosis)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(RDSTableCheck<span class="sc">$</span>FeatureTypes<span class="sc">$</span>RDS_Diagnosis)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(RDSTableCheck<span class="sc">$</span>NonMissingValueRates<span class="sc">$</span>RDS_Diagnosis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="first-data-transformation-curation" class="level4">
<h4 class="anchored" data-anchor-id="first-data-transformation-curation">First data transformation: Curation</h4>
<p>Now we can perform the first big processing step: The transformation of the <em>Raw Data Set (RDS)</em> into the <em>Curated Data Set (CDS)</em>. This is done in one ‘big sweep’ by calling <code>ds.CurateData()</code>. This function uses meta data stored in the <code>dsCCPhos</code> package to perform a series of cleaning and harmonization steps, including:</p>
<ul>
<li>Harmonization of table meta data and structure</li>
<li>Entry exclusion (unlinked and duplicate entries, or ones that are missing obligatory features)</li>
<li>Value harmonization (Recoding, Classification, Formatting)</li>
</ul>
<p>All of these processing steps can potentially be controlled by specific arguments and meta data objects, but we will not get into those details at this point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform Raw Data Set (RDS) into Curated Data Set (CDS) (using default settings)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Curation <span class="ot">&lt;-</span> <span class="fu">ds.CurateData</span>(<span class="at">RawDataSetName =</span> <span class="st">"RawDataSet"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">OutputName =</span> <span class="st">"CurationOutput"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">DataSources =</span> CCPConnections)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>CDSTableCheck <span class="ot">&lt;-</span> <span class="fu">ds.CheckDataSet</span>(<span class="at">DataSources =</span> CCPConnections,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">DataSetName =</span> <span class="st">"CuratedDataSet"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">AssumeCCPDataSet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The server-side output of this process is stored in the <code>list</code> object <code>CurationOutput</code>. It contains the newly created <em>CuratedDataSet (CDS)</em> (<code>list</code>) as well as a <em>CurationReport</em>, an object that contains meta data that resulted from tracing the performed processing steps, for example the ‘transformational path’ that the raw data values took. To comfortably access the information stored in all server-specific <em>CurationReports</em> we can call another function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>CurationReport <span class="ot">&lt;-</span> <span class="fu">ds.GetCurationReport</span>(<span class="at">DataSources =</span> CCPConnections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at the resulting object <code>CurationReport</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplary for the 'Staging' table, get an overview of the attrition this table experienced during the Cutation process:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(CurationReport<span class="sc">$</span>EntryCounts<span class="sc">$</span>Staging)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can look at similar data on feature-level...</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(CurationReport<span class="sc">$</span>Transformation<span class="sc">$</span>All<span class="sc">$</span>EligibilityOverviews<span class="sc">$</span>Staging)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ...or even dive into the level of distinct feature values and their respective transformational paths</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(CurationReport<span class="sc">$</span>Transformation<span class="sc">$</span>All<span class="sc">$</span>Monitors<span class="sc">$</span>Staging)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is no need to dive into this monitoring data every time you carry out the processing. However, it will enable you to make sure that the processing did not induce any artifical biases.</p>
<p>Let’s focus back on the <em>CuratedDataSet</em> that is now stored in all server-side R sessions. Again, we can use the function <code>ds.CheckDataSet</code> to get a grasp of the overall data quality:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>CDSTableCheck <span class="ot">&lt;-</span> <span class="fu">ds.CheckDataSet</span>(<span class="at">DataSources =</span> CCPConnections,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">DataSetName =</span> <span class="st">"CuratedDataSet"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">AssumeCCPDataSet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look at non-missing rates in exemplary table 'Staging'</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(CDSTableCheck<span class="sc">$</span>NonMissingValueRates<span class="sc">$</span>Staging)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="second-data-transformation-augmentation" class="level4">
<h4 class="anchored" data-anchor-id="second-data-transformation-augmentation">Second data transformation: Augmentation</h4>
<p>While we could now use these <em>CDS</em> tables to perform some sort of analysis, our data is still extremely separated in different tables. To get analysis-ready data we need to establish links between the existing tables in a meaningful way. To take it a step further we can also try to create new features leveraging traditional data science or machine learning methods. This is what the next step <em>Augmentation</em> does. Again, we call one big function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Messages <span class="ot">&lt;-</span> <span class="fu">ds.AugmentData</span>(<span class="at">CuratedDataSetName =</span> <span class="st">"CuratedDataSet"</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">OutputName =</span> <span class="st">"AugmentationOutput"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">DataSources =</span> CCPConnections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting <em>AugmentedDataSet (ADS)</em> (<code>list</code>) contains the following <code>data.frames</code>:</p>
<ul>
<li><code>Events</code></li>
<li><code>DiseaseCourse</code></li>
<li><code>Therapy</code></li>
<li><code>Diagnosis</code></li>
<li><code>Patient</code></li>
</ul>
<p>Again, we could check out the data completeness of this new data set using the familiar function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ADSTableCheck <span class="ot">&lt;-</span> <span class="fu">ds.CheckDataSet</span>(<span class="at">DataSources =</span> CCPConnections,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">DataSetName =</span> <span class="st">"AugmentedDataSet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To facilitate further processing, let’s ‘unpack’ the <code>data.frames</code> from <code>AugmentedDataSet</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make tables from Augmented Data Set directly addressable by unpacking them into R server session</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Messages <span class="ot">&lt;-</span> <span class="fu">ds.UnpackAugmentedDataSet</span>(<span class="at">AugmentedDataSetName =</span> <span class="st">"AugmentedDataSet"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">DataSources =</span> CCPConnections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="server-workspaces-and-object-meta-data" class="level4">
<h4 class="anchored" data-anchor-id="server-workspaces-and-object-meta-data">Server workspaces and object meta data</h4>
<p>Before we jump directly into working with these data, let us briefly look at some methods to learn more about the objects on the server-side <em>R</em> sessions. This is important to be able to keep orientation about what’s actually going on in the server workspaces and to construct further processing steps.</p>
<p>If we want to get meta data about a particular <em>R</em> object we can call <code>ds.GetObjectMetaData()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ObjectMetaData <span class="ot">&lt;-</span> <span class="fu">ds.GetObjectMetaData</span>(<span class="at">ObjectName =</span> <span class="st">"ADS_Patient"</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">DataSources =</span> CCPConnections)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can look at the structure of the object</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(ObjectMetaData<span class="sc">$</span>SiteA<span class="sc">$</span>Structure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>